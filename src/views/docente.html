<!DOCTYPE html>
<html lang="es">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Panel del Docente</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="/css/docente.css">
        <!-- Firebase CDN -->
        <link rel="icon" href="/favicon.ico">
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
        <script>
            var firebaseConfig = {
                apiKey: "AIzaSyAjoGGduHwTctK12k7dPfHqd0116dQylzE",
                authDomain: "registro-asistenciaqr.firebaseapp.com",
                databaseURL: "https://registro-asistenciaqr-default-rtdb.firebaseio.com",
                projectId: "registro-asistenciaqr",
                storageBucket: "registro-asistenciaqr.appspot.com",
                messagingSenderId: "928437205377",
                appId: "1:928437205377:web:463905979dbd2af9d85080"
            };
            firebase.initializeApp(firebaseConfig);
        </script>
</head>
<body>

    <!-- Panel Principal del Docente -->
    <div id="panelDocente" class="container">
        <header class="header">
            <div class="header-content">
                <div class="user-welcome">
                    <div class="avatar">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div>
                        <h1>Panel del Docente</h1>
                        <p>Bienvenido, <span id="nombreDocente"></span></p>
                    </div>
                </div>
                <button id="btnCerrarSesion" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    Cerrar Sesión
                </button>
            </div>
        </header>

        <!-- Panel Principal -->
        <div class="main-panel">
            <!-- Datos del Docente -->
            <div class="form-group">
                <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
                    <label for="nombreDocenteInput" style="margin:0;">
                        <i class="fas fa-id-badge"></i>
                        Nombre del Docente
                    </label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <button onclick="togglePreviewDocente()" class="nav-btn secondary" title="Previsualizar" style="padding:10px 14px;">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="mostrarFormularioDocente()" class="nav-btn secondary" title="Mostrar formulario" style="padding:10px 14px;">
                            <i class="fas fa-sliders-h"></i>
                        </button>
                    </div>
                </div>

                <!-- Previsualización del nombre (oculta por defecto) -->
                <div id="docentePreview" class="docente-preview" style="display:none; margin-top:10px;">
                    <i class="fas fa-user"></i>
                    <span id="docenteNombrePreview">—</span>
                </div>

                <!-- Formulario editable (oculto por defecto) -->
                <div id="docenteFormSection" style="display:none; margin-top:12px;">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input id="nombreDocenteInput" type="text" class="form-input" placeholder="Ingrese su nombre" />
                        <button onclick="guardarNombreDocente()" class="nav-btn primary" style="white-space:nowrap;">
                            <i class="fas fa-save"></i>
                            Guardar
                        </button>
                        <button onclick="editarNombreDocente()" class="nav-btn secondary" title="Editar nombre" style="padding:10px 14px;">
                            <i class="fas fa-pen"></i>
                        </button>
                        <button onclick="ocultarFormularioDocente()" class="nav-btn secondary" title="Ocultar" style="padding:10px 14px;">
                            <i class="fas fa-eye-slash"></i>
                        </button>
                    </div>
                </div>
            </div>
            <!-- Preferencias del Docente: Carrera y Ciclo -->
            <div class="form-group" style="margin-top:10px;">
                <div class="form-row" style="display:flex; gap:16px; flex-wrap:wrap;">
                    <div style="flex:1; min-width:240px;">
                        <label for="carreraDocente"><i class="fas fa-graduation-cap"></i> Carrera</label>
                        <div class="select-container">
                            <select id="carreraDocente" class="form-select">
                                <option value="">-- Seleccione una carrera --</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                    </div>
                    <div style="flex:1; min-width:240px;">
                        <label for="cicloDocente"><i class="fas fa-layer-group"></i> Ciclo</label>
                        <div class="select-container">
                            <select id="cicloDocente" class="form-select">
                                <option value="">-- Seleccione un ciclo --</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Paso 1: Selección de Unidad Didáctica -->
            <div id="step1" class="step active">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h2>Seleccione su Unidad Didáctica</h2>
                </div>
                
                <div class="form-group">
                    <label for="unidadSelect">
                        <i class="fas fa-book"></i>
                        Unidad Didáctica:
                    </label>
                    <div class="select-container">
                        <select id="unidadSelect" class="form-select">
                            <option value="">-- Seleccione una unidad --</option>
                        </select>
                        <i class="fas fa-chevron-down select-arrow"></i>
                    </div>
                </div>

                <button onclick="avanzarStep2()" class="next-btn" disabled id="btnStep1">
                    <i class="fas fa-arrow-right"></i>
                    Siguiente: Seleccionar Turno
                </button>
            </div>

            <!-- Paso 2: Selección de Turno -->
            <div id="step2" class="step">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h2>Seleccione el Turno</h2>
                    <p class="selected-unit" id="selectedUnitText"></p>
                </div>
                
                <div class="form-group">
                    <label for="turnoSelect">
                        <i class="fas fa-clock"></i>
                        Turno:
                    </label>
                    <div class="select-container">
                        <select id="turnoSelect" class="form-select">
                            <option value="">-- Seleccione un turno --</option>
                            <option value="Mañana">Turno Mañana (06:00 AM - 01:00 PM)</option>
                            <option value="Tarde">Turno Tarde (01:30 PM - 06:30 PM)</option>
                            <option value="Noche">Turno Noche (05:00 PM - 10:00 PM)</option>
                        </select>
                        <i class="fas fa-chevron-down select-arrow"></i>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button onclick="volverStep1()" class="nav-btn secondary">
                        <i class="fas fa-arrow-left"></i>
                        Volver
                    </button>
                    <button onclick="avanzarStep3()" class="nav-btn primary" disabled id="btnStep2">
                        <i class="fas fa-qrcode"></i>
                        Siguiente: Generar QR
                    </button>
                </div>
            </div>

            <!-- Paso 3: Generación de QR -->
            <div id="step3" class="step">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h2>Generar Código QR de Asistencia</h2>
                    <p class="session-info" id="sessionInfo"></p>
                </div>
                
                <div class="session-details">
                    <div class="detail-card">
                        <i class="fas fa-book"></i>
                        <div>
                            <span class="detail-label">Unidad Didáctica</span>
                            <span class="detail-value" id="detailUnidad"></span>
                        </div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-clock"></i>
                        <div>
                            <span class="detail-label">Turno</span>
                            <span class="detail-value" id="detailTurno"></span>
                        </div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-calendar"></i>
                        <div>
                            <span class="detail-label">Fecha</span>
                            <span class="detail-value" id="detailFecha"></span>
                        </div>
                    </div>
                </div>

                <div class="qr-section">
                    <button onclick="generateQRCode()" class="generate-btn" id="btnGenerarQR">
                        <i class="fas fa-qrcode"></i>
                        Generar Código QR de Asistencia
                    </button>
                    
                    <div id="qrContainer" class="qr-container">
                        <div class="qr-header">
                            <h3>Código QR Activo</h3>
                            <div class="timer-display">
                                <i class="fas fa-clock"></i>
                                <span id="timer">10:00</span>
                            </div>
                        </div>
                        <div id="qrcode" class="qr-code"></div>
                        <div class="qr-instructions">
                            <p><i class="fas fa-info-circle"></i> Los estudiantes deben escanear este código</p>
                            <p><i class="fas fa-users"></i> Asistentes: <span id="attendanceCount">0</span> registrados</p>
                        </div>
                    </div>
                </div>

                <div class="attendance-section">
                    <h3>Registro de Asistencia en Tiempo Real</h3>
                    <div id="attendanceRecords" class="records-container">
                        <div class="empty-state">
                            <i class="fas fa-users-slash"></i>
                            <p>Esperando escaneos de estudiantes...</p>
                        </div>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button onclick="volverStep2()" class="nav-btn secondary">
                        <i class="fas fa-arrow-left"></i>
                        Volver
                    </button>
                    <button onclick="finalizarSesion()" class="nav-btn danger">
                        <i class="fas fa-check"></i>
                        Finalizar Sesión
                    </button>
                </div>
            </div>
        </div>

        <!-- Mensajes de Estado -->
        <div id="statusMessage" class="status-message">
            <i class="fas fa-info-circle"></i>
            <span id="statusText">Seleccione una unidad didáctica para comenzar</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="/js/docente.js"></script>
</body>
</html>